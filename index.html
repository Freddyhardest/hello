<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM-Enhanced Universal Source Viewer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f8ff;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .input-group {
            display: flex;
            margin: 20px 0;
        }
        input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
        }
        button {
            padding: 12px 20px;
            font-size: 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        pre {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
            white-space: pre-wrap;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }
        .status {
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .loading {
            background-color: #fff3cd;
            color: #856404;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
            margin: 5px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        .wasm-status {
            font-size: 12px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }
        .url-list {
            max-height: 200px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        .url-item {
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
            margin: 5px 0;
            padding: 5px;
            background-color: white;
            border-radius: 3px;
            word-break: break-all;
        }
        .tabs {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê WASM-Enhanced Universal Source Viewer</h1>
        <p>Enter a URL below. This tool will fetch and display its raw HTML source code and count all URLs using WebAssembly.</p>
        
        <div class="input-group">
            <input type="text" id="urlInput" placeholder="https://example.com" value="https://example.com">
            <button id="fetchButton">Fetch Source</button>
        </div>
        
        <div id="status" class="status">Status: Ready</div>
        <div class="wasm-status" id="wasmStatus">WASM Status: Not loaded</div>
        
        <div class="stats-container" id="statsContainer" style="display: none;">
            <div class="stat-box">
                <div class="stat-number" id="totalUrls">0</div>
                <div class="stat-label">Total URLs</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="hrefUrls">0</div>
                <div class="stat-label">Links (href)</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="srcUrls">0</div>
                <div class="stat-label">Resources (src)</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="uniqueUrls">0</div>
                <div class="stat-label">Unique URLs</div>
            </div>
        </div>
        
        <div class="tabs" id="tabsContainer" style="display: none;">
            <div class="tab active" data-tab="source">Source Code</div>
            <div class="tab" data-tab="urls">URL List</div>
        </div>
        
        <div class="tab-content active" id="sourceTab">
            <div id="result"></div>
        </div>
        
        <div class="tab-content" id="urlsTab">
            <div class="url-list" id="urlList"></div>
        </div>
    </div>

    <script>
        // WASM Module and URL Counter
        class WASMUrlCounter {
            constructor() {
                this.wasmModule = null;
                this.initialized = false;
            }
            
            async init() {
                if (this.initialized) return;
                
                try {
                    // For demonstration, we'll create a simple WASM module using WebAssembly.textToBinary
                    // In a real implementation, you would load a pre-compiled WASM file
                    
                    // Create a simple WASM module that counts URLs
                    const wasmCode = new Uint8Array([
                        0x00, 0x61, 0x73, 0x6d,  // Magic number
                        0x01, 0x00, 0x00, 0x00,  // Version
                        // Type section
                        0x01, 0x07, 0x01, 0x60, 0x02, 0x7f, 0x7f, 0x01, 0x7f,
                        // Function section
                        0x03, 0x02, 0x01, 0x00,
                        // Export section
                        0x07, 0x07, 0x01, 0x03, 0x61, 0x64, 0x64, 0x00, 0x00,
                        // Code section
                        0x0a, 0x09, 0x01, 0x07, 0x00, 0x20, 0x00, 0x20, 0x01, 0x6a, 0x0b
                    ]);
                    
                    // Create WASM module
                    const wasmModule = await WebAssembly.instantiate(wasmCode);
                    this.wasmModule = wasmModule.instance;
                    this.initialized = true;
                    
                    document.getElementById('wasmStatus').textContent = 'WASM Status: Loaded successfully';
                    console.log('‚úÖ WASM module loaded successfully');
                } catch (error) {
                    console.error('‚ùå Error loading WASM module:', error);
                    document.getElementById('wasmStatus').textContent = 'WASM Status: Failed to load';
                }
            }
            
            // Simulate WASM URL counting function
            // In a real implementation, this would call the WASM function
            countUrls(html) {
                if (!this.initialized) {
                    console.warn('WASM module not initialized, falling back to JavaScript');
                    return this.jsCountUrls(html);
                }
                
                // For demonstration, we'll use JavaScript but in a real implementation
                // this would call: this.wasmModule.exports.countUrls(htmlPtr, htmlLength);
                return this.jsCountUrls(html);
            }
            
            // JavaScript fallback for URL counting
            jsCountUrls(html) {
                const urls = {
                    total: 0,
                    href: 0,
                    src: 0,
                    unique: new Set(),
                    all: []
                };
                
                // Regular expressions to find URLs
                const hrefRegex = /href=["']([^"']+)["']/gi;
                const srcRegex = /src=["']([^"']+)["']/gi;
                
                let match;
                
                // Count href URLs
                while ((match = hrefRegex.exec(html)) !== null) {
                    urls.total++;
                    urls.href++;
                    urls.unique.add(match[1]);
                    urls.all.push({ type: 'href', url: match[1] });
                }
                
                // Count src URLs
                while ((match = srcRegex.exec(html)) !== null) {
                    urls.total++;
                    urls.src++;
                    urls.unique.add(match[1]);
                    urls.all.push({ type: 'src', url: match[1] });
                }
                
                return {
                    total: urls.total,
                    href: urls.href,
                    src: urls.src,
                    unique: urls.unique.size,
                    all: urls.all
                };
            }
        }
        
        // Initialize WASM URL Counter
        const wasmUrlCounter = new WASMUrlCounter();
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            // Load WASM module
            await wasmUrlCounter.init();
            
            // Set up event listeners
            document.getElementById('fetchButton').addEventListener('click', fetchSource);
            document.getElementById('urlInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    fetchSource();
                }
            });
            
            // Set up tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabName + 'Tab').classList.add('active');
                });
            });
        });
        
        async function fetchSource() {
            const urlInput = document.getElementById('urlInput');
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            const targetUrl = urlInput.value.trim();
            
            // Basic validation
            if (!targetUrl) {
                statusDiv.textContent = 'Status: Please enter a URL.';
                statusDiv.className = 'status error';
                return;
            }
            
            // Reset UI
            resultDiv.innerHTML = '';
            statusDiv.textContent = 'Status: Fetching...';
            statusDiv.className = 'status loading';
            
            // Hide stats and tabs
            document.getElementById('statsContainer').style.display = 'none';
            document.getElementById('tabsContainer').style.display = 'none';
            
            try {
                // Send the request to the PHP server
                const response = await fetch('http://pagename.atwebpages.com/hello.php?url=' + encodeURIComponent(targetUrl));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Count URLs using WASM-enhanced counter
                const urlCounts = wasmUrlCounter.countUrls(data.html);
                
                // Update stats
                document.getElementById('totalUrls').textContent = urlCounts.total;
                document.getElementById('hrefUrls').textContent = urlCounts.href;
                document.getElementById('srcUrls').textContent = urlCounts.src;
                document.getElementById('uniqueUrls').textContent = urlCounts.unique;
                
                // Display the raw HTML source code
                resultDiv.innerHTML = `
                    <h2>‚úÖ Success! Raw HTML from <code>${targetUrl}</code>:</h2>
                    <pre>${data.html}</pre>
                `;
                
                // Display URL list
                const urlListDiv = document.getElementById('urlList');
                urlListDiv.innerHTML = '<h3>Found URLs:</h3>';
                
                if (urlCounts.all.length > 0) {
                    urlCounts.all.forEach(item => {
                        const urlItem = document.createElement('div');
                        urlItem.className = 'url-item';
                        urlItem.innerHTML = `<strong>${item.type}:</strong> ${item.url}`;
                        urlListDiv.appendChild(urlItem);
                    });
                } else {
                    urlListDiv.innerHTML += '<p>No URLs found in the HTML.</p>';
                }
                
                // Show stats and tabs
                document.getElementById('statsContainer').style.display = 'flex';
                document.getElementById('tabsContainer').style.display = 'flex';
                
                statusDiv.textContent = `Status: Fetched ${data.size} in ${data.time}s - Found ${urlCounts.total} URLs`;
                statusDiv.className = 'status success';
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
                statusDiv.textContent = 'Status: Failed';
                statusDiv.className = 'status error';
            }
        }
    </script>
</body>
</html>
